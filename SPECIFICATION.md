# Coronavirus Web Scraper

Версия 1.1

## Описание

Приложението **Coronavirus Web Scraper** периодично събира статистически данни свързани с разпространението, лечението
и борбата с COVID-19. За целта, то извлича информация от [Единния информационен портал за COVID-19](https://coronavirus.bg/),
привежда я в структуриран вид и я записва в Системата за управление на бази данни (СУБД) за последваща обработка.

## Функционални изисквания

Приложението следва да отговаря на следните функционални изисквания:

- Приложението е реализирано като уеб приложение.
  - Вж. [ASP.NET Core](https://docs.microsoft.com/en-us/aspnet/core/).
- Приложението съдържа статична индексна страница с връзки към останалите страници.
  - Вж. [Static files in ASP.NET Core](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/static-files).
- Приложението съдържа една или повече динамични страници за преглед на съхранените данни.
  - Вж. [Razor Pages](https://docs.microsoft.com/en-us/aspnet/core/razor-pages/) или
    [MVC](https://docs.microsoft.com/en-us/aspnet/core/mvc/overview).
- Приложението предоставя крайна точка за проверка на състоянието, в т.ч. връзката към базата.
  - Вж. [Health checks in ASP.NET Core](https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/health-checks).
- Извличането на данните е реализирано като фонова задача, която се изпълнява периодично във фонов режим.
  - Вж. [Background tasks with hosted services in ASP.NET Core](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services).

### Страници

Приложението съдържа минимално следните страници:

- Страница "Начало":
  - съдържа заглавието на сайта, кратко описание (в изречение или две) и връзки към останалите страници.
- Страница "Данни":
  - съдържа календар, с който потребителят може да избере дата, за която има извлечени данни;
  - при посочване на дата, се визуализират събраните за нея данни (възможно е в отделна страница);
- Страница "Анализ" (по желание):
  - една или повече графики на първични (активни случаи, хоспитализирани и т.н.) и производни
    (заразени/тествани, интензивни/хоспитализирани и др.) данни.

### Извличане на данните

Задачата по извличане на данни се изпълнява периодично и не трябва две такива задачи да работят едновременно.

Извличането на данни се изпълнява по следната процедура:

1. Отваря основната страница (https://coronavirus.bg/).
   - Извлича датата и часа
   - Извлича статистиката за:
     - направени тестове (общо и за последното денонощие)
     - потвърдени случаи (общо и за последното денонощие)
     - активни случаи (текущо)
     - излекувани (общо и за последното денонощие)
     - хоспитализирани (текущо)
     - в интензивно отделение (текущо)
     - починали (общо и за последното денонощие)
     - ваксинирани (общо и за последното денонощие)
2. Намира връзката с "Актуална статистика в България" и посещава линка (https://coronavirus.bg/bg/statistika).
   - Извлича разпределение на потвърдените случаи по:
     - възрастови групи
     - области
     - тип медицински персонал
   - Извлича данни за направените тестове според типа на теста (общо и за последното денонощие)
   - Извлича данни за потвърдените случаи според типа на теста (общо и за последното денонощие)
   - Извлича данни за направените ваксинации по области, в т.ч.:
     - общо поставени дози
     - общо напълно ваксинирани
     - за последното денонощие по вид ваксина
   - Изчислява общо направените ваксинации по области за последното денонощие
3. Проверява данните за несъответствия.
   - направените тестове по тип (сумата дава общо за последното денонощие)
   - потвърдените случаи по тип (сумата дава общо за последното денонощие)
   - потвърдените случаи по области (сумата дава общо за последното денонощие)
   - направените ваксинации по тип (сумата дава общо за последното денонощие)
   - и т.н.
4. Записва данните в NoSQL база данни (напр. MongoDB) под формата на документ с подходяща йерархична структура.
   - Всеки документ съдържа информация за:
     - датата, за която се отнася
     - събраните данни
     - състояние (несъответствия, одобрен)
     - резултатите от проверките за несъответствия:
       - текст описващ несъответствието
       - списък от проверяваните полета
       - очаквана стойност
       - получена стойност

### Структура на данните

Данните за всеки ден представляват документ със следната структура:

```jsonc
{
  // дата/час, за която се отнасят данните, в ISO 8601 формат (в т.ч. съответната часова зона)
  "date": "2021-04-14T00:00:00+02:00",
  // дата/час, когато данните са извлечени в ISO 8601 формат
  "date_scraped": "2021-04-14T10:11:12Z",
  // двубуквен код на страната, според ISO 3166-1 alpha-2
  "country": "BG",
  "overall": {
    "tested": {
      // Тествани (общо)
      "total": 2303963,
      "total_by_type": {
        // Тествани PCR (общо)
        "pcr": 1755143,
        // Тествани антиген (общо)
        "antigen": 548820
      },
      // Тествани (24 ч)
      "last": 16242,
      "last_by_type": {
        // Тествани PCR (24 ч)
        "pcr": 9268,
        // Тествани антиген (24 ч)
        "antigen": 6974
      },
    },
    "confirmed": {
      // Потвърдени (общо)
      "total": 378059,
      "total_by_type": {
        // Потвърдени PCR (общо)
        "pcr": 302480,
        // Потвърдени антиген (общо)
        "antigen": 75579
      },
      // Потвърдени (24 ч)
      "last": 2944,
      "last_by_type": {
        // Потвърдени PCR (24 ч)
        "pcr": 1844,
        // Потвърдени антиген (24 ч)
        "antigen": 1100
      },
      "medical": {
        // Медицински лица (общо)
        "total": 12670,
        "total_by_type": {
          // Доктори (общо)
          "doctor": 3707,
          // Медицински сестри (общо)
          "nurces": 4277,
          // Санитари (общо)
          "paramedics_1": 2067,
          // Фелдшери (общо)
          "paramedics_2": 274,
          // Друг мед. персонал (общо)
          "other": 2345
        },
        // Медицински лица (24 ч)
        "last": 82,
        "last_by_type": {
          // Доктори (24 ч)
          "doctor": 19,
          // Медицински сестри (24 ч)
          "nurces":29,
          // Санитари (24 ч)
          "paramedics_1": 18,
          // Фелдшери (24 ч)
          "paramedics_2": 1,
          // Друг мед. персонал (24 ч)
          "other": 15
        },
      }
    },
    "active": {
      // Активни случаи (текущо)
      "current": 69962,
      "current_by_type": {
        // Хоспирализирани (текущо)
        "hospitalized": 9799,
        // Интензивни (текущо)
        "icu": 799
      }
    },
    "recovered": {
      // Излекувани (общо)
      "total": 293351,
      // Излекувани (24 ч)
      "last": 3995
    },
    "deceased": {
      // Починали (общо)
      "total": 14746,
      // Починали (24 ч)
      "last": 127
    },
    "vaccinated": {
      // Ваксинирани (общо)
      "total": 590495,
      // Ваксинирани (24 ч)
      "last": 10503,
      "last_by_type": {
        // Ваксинирани - Pfeizer (24 ч)
        "pfeizer": 6496,
        // Ваксинирани - AstraZeneca (24 ч)
        "astrazeneca": 554,
        // Ваксинирани - Moderna (24 ч)
        "moderna": 3453,
        // Ваксинирани - Janssen (24 ч)
        "janssen": 0
     },
     // Напълно ваксинирани (общо)
     "total_completed": 116423
    }
  },
  "regions": {
    // Благоевград
    "blg": {
      "confirmed": {
        // Потвърдени - Благоевград (общо)
        "total": 16954,
        // Потвърдени - Благоевград (24 ч)
        "last": 91
      },
      "vaccinated": {
        // Ваксинирани - Благоевград (общо)
        "total": 17573,
        // Ваксинирани - Благоевград (24 ч)
        "last": null,
        "last_by_type": {
          // Ваксинирани - Благоевград - Pfeizer (24 ч)
          "pfeizer": 273,
          // Ваксинирани - Благоевград - AstraZeneca (24 ч)
          "astrazeneca": 18,
          // Ваксинирани - Благоевград - Moderna (24 ч)
          "moderna": 10,
          // Ваксинирани - Благоевград - Janssen (24 ч)
          "janssen": 0
       },
       // Напълно ваксинирани (общо)
       "total_completed": 2873
      }
    }
    // ... Аналогично за останалите региони
  },
  "stats":{
    "tested": {
      "total_by_type_prc": {
        // Тествани PCR [%] (общо)
        "pcr": 0.5706,
        // Тествани антиген [%] (общо)
        "antigen": 0.4294
      },
      "last_by_type_prc": {
        // Тествани PCR [%] (24 ч)
        "pcr": 0.7618,
        // Тествани антиген [%] (24 ч)
        "antigen": 0.2382
      }
    },
    "confirmed": {
      // Потвърдени/Тествани [%] (общо)
      "total_per_tested_prc": 0.1641,
      // Потвърдени/Тествани [%] (24 ч)
      "last_per_tested_prc": 0.1813,
      "total_by_type_prc": {
        // Потвърдени PCR [%] (общо)
        "pcr": 0.5706,
        // Потвърдени антиген [%] (общо)
        "antigen": 0.4294
      },
      "last_by_type_prc": {
        // Потвърдени PCR [%] (24 ч)
        "pcr": 0.6264,
        // Потвърдени антиген [%] (24 ч)
        "antigen": 0.3736
      },
      // Медицински/потвърдени [%] (24 ч)
      "medical_prc": 0.0279
    },
    "active": {
      // Хоспитализирани/Активни [%] (текущо)
      "hospitalized_per_active": 0.1401,
      // Интензивни/Хоспитализирани [%] (текущо)
      "icu_per_hospitalized": 0.815
    }
  }
}
```

**Забележка:** Регионите са представени със своя трибуквен код по ЕКАТТЕ (вж. [GitHub Gist](https://gist.github.com/yurukov/4f7e50facc8fc54c5070)).

### Настройка

Настройката на системата следва да използва стандартен механизъм на конфигуриране в JSON файл и трябва да включва:

- период на изпълнение на задачата за извличане на данни
- стандартен низ за връзка към Системата за управление на бази данни (СУБД)

## Нефункционални изисквания

Приложението следва да изпълнява следните нефункционални изисквания:

- Приложението е разработено на езика C#.
- Приложението е реализирано върху платформа [.NET 5](https://docs.microsoft.com/en-us/dotnet/core/dotnet-five) (или по-нов).
- Приложението е реализирано като ASP.NET Core приложение, като:
 - Страниците в приложението генерират валиден HTML 5/CSS/JavaScript код.
 - Използват [Bootstrap](https://getbootstrap.com/) или друг сходен framework за responsive визуализация.
 - Ако се рисуват графики, може да се използва [Google Charts](https://developers.google.com/chart).
- Приложението е документирано, както следва:
  - кратко описание и инструкции за изпълнение - в *README.md* файл в основната директория;
  - настоящото задание - в *SPECIFICATION.md* файл в основната директория.
- Кодът е документиран с помощта на XML документация **на английски език**.
  - Такава е използвана з всички класове, интерфейси, изброими списъци, методи, свойства, полета, възможни стойности и др., които не са `private`.
- Именуването на идентификаторите следва единна конвенция.
  - Вж. [Naming Guidelines](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/naming-guidelines).
- Приложението може да използва безплатни библиотеки, под формата на NuGet пакети, за извличане и анализ на съдържанието.
  - Вж. [HTML Agility Pack](https://html-agility-pack.net/), [AngleSharp](https://anglesharp.github.io/), [ScrappySharp](https://github.com/rflechner/ScrapySharp) и др.
- Кодът на приложението е публикуван в хранилище [GitHub](https://github.com/) заедно с историята на промените му.

## Права

Авторските права върху кода на приложението остават в неговия автор.

Авторските права върху настоящия документ са на [ДАВИД Холдинг АД](https://www.david.bg).
